---
title: "Analysis"
output: html_document
date: '2022-05-03'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### For this first analysis, we are going to focus on the dataset Beef_data

We want to know if we can forecast the global price of beef just with the historical data.
### Plotting the data Global Price of beef in the world
```{r}
Beef_data.tsibble %>% autoplot(Global_price_of_beef)+geom_line()
```

```{r}
p <- ggplot(Beef_data.tsibble, aes(x=DATE, y=Global_price_of_beef)) +
  geom_line( color="steelblue") + 
  geom_point() +
  xlab("") +
  scale_y_continuous()

p
```



## Decomposition of every 5 years
```{r}
Beef.90_95 <- filter(Beef_data, DATE >= "1990-01-01", DATE <= "1995-01-01")
Beef.90_95 <- as_tsibble(Beef.90_95)
p1 <- Beef.90_95%>%
  autoplot(Global_price_of_beef)

Beef.95_00 <- filter(Beef_data, DATE >= "1995-01-01", DATE <= "2000-01-01")
Beef.95_00<- as_tsibble(Beef.95_00)
p2 <- Beef.95_00%>%
  autoplot(Global_price_of_beef)

Beef.00_05 <- filter(Beef_data, DATE >= "2000-01-01", DATE <= "2005-01-01")
Beef.00_05<- as_tsibble(Beef.00_05)
p3 <- Beef.00_05%>%
  autoplot(Global_price_of_beef)

Beef.05_10 <- filter(Beef_data, DATE >= "2005-01-01", DATE <= "2010-01-01")
Beef.05_10<- as_tsibble(Beef.05_10)
p4 <- Beef.05_10%>%
  autoplot(Global_price_of_beef)

Beef.10_15 <- filter(Beef_data, DATE >= "2010-01-01", DATE <= "2015-01-01")
Beef.10_15<- as_tsibble(Beef.10_15)
p5 <- Beef.10_15%>%
  autoplot(Global_price_of_beef)

Beef.15_21 <- filter(Beef_data, DATE >= "2015-01-01", DATE <= "2021-12-01")
Beef.15_21<- as_tsibble(Beef.15_21)
p6 <- Beef.15_21%>%
  autoplot(Global_price_of_beef)
```

```{r}
plot_grid(p1, p2, p3, p4, p5, p6)
```
No real pattern apparent...No cyclic or seasonal after decomposition


# Decompostion does not work 
```{r}
#Beef.15_21 %>% decompose(type="multiplicative") %>%
  #autoplot() + xlab("Year") +
  #ggtitle("Classical multiplicative decomposition")
# time series has no or less than 2 periods

```

```{r}
#beef_Comp <- decompose(Beef_data.tsibble)
```

With this non apparent pattern, we can try to apply the difference to the time serie. Making it non-sationnary could be helpful and apply an ARIMA model

# Differential
```{r}
# Apply the first difference to the dataset beef_data.tsibble
Beef_data.tsibble %>% autoplot(log(Global_price_of_beef))
Beef.diff <- Beef_data.tsibble %>% autoplot(log(Global_price_of_beef) %>% difference())
Beef.diff
```
The data transformations of differencing make this time series stationary


```{r}
fit <- Beef_data.tsibble %>%
  model(ARIMA(Global_price_of_beef))
report(fit)
```

```{r}
fit %>% forecast(h=24) %>%
  autoplot(Beef_data.tsibble)
```

```{r}
# acf(Beef_data.tsibble, na.action = na.pass)
```

```{r}
Beef_data.tsibble %>%
  ACF(Global_price_of_beef) %>%
  autoplot()
```

```{r}
#Fitting the AR Model to the time series
```

```{r}
fit.beef<- Beef_data.tsibble %>% 
  model(ARIMA(Global_price_of_beef ~ pdq(1,1,1)))
report(fit.beef)
```



```{r}
Beef_data.tsibble %>%
  gg_tsdisplay(difference(Global_price_of_beef), plot_type='partial')
```

```{r}
#Beef_data.tsibble %>%
  #forecast(h=5) %>%
  #filter(.model=='search') %>%
  #autoplot(Global_price_of_beef)
```


```{r}
naive_mod <- naive(Beef_data.tsibble, h = 6)
summary(naive_mod)
```

```{r}
#se_model <- ses(Beef_data.tsibble, h = 12)
#summary(se_model)
```


```{r}
TOTAL <- merge(Beef_data.tsibble, Beef_US_price.tsibble, by = 'DATE')
TOTAL$US_beef_price <- TOTAL$US_beef_price*100
```

```{r}
ggplot(TOTAL, aes(x=DATE)) + 
  geom_line(aes(y = US_beef_price), color = "darkred") + 
  geom_line(aes(y = Global_price_of_beef), color="steelblue")

plot(TOTAL)

```


```{r}
#Beef_US_Comp <- decompose(Beef_US_price.tsibble)

#time series has no or less than 2 periods
```

```{r}

```

```{r}

```


```{r}

```

```{r}

```


