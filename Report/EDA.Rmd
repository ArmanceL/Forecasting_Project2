---
title: "EDA"
output: html_document
date: '2022-05-03'
---

```{r, echo = FALSE, message = FALSE}
source(here::here("scripts/setup.R"))
```

# Exploratory Data Analysis 

Let's import the dataset. 

```{r}
Beef_data <- read.csv2("../Data/BeefPrice.csv")
Commodity_Price_index <- read.csv("../Data/Commodity.price.index.csv")
Beef_production_world <- read.csv("../Data/beef-and-buffalo-meat-production-tonnes.csv")
Beef_US_price <- read.csv("../Data/Beef_price_US.csv")
Corn_price_US <- read.csv('../Data/corn_price_US.csv')
Corn_price <- read_delim('../Data/corn-prices-historical-chart-data.csv', 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
```


## Primary analysis of the database

```{r}
str(Beef_data)
str(Commodity_Price_index)
str(Beef_production_world)
str(Beef_US_price)
```

```{r}
which(is.na(Beef_data))
which(is.na(Commodity_Price_index))
which(is.na(Beef_production_world))
which(is.na(Beef_US_price))
```
no missing values
...
...
...


```{r}
names(Beef_data)[2] <- 'Global_price_of_beef'

Beef_data$Global_price_of_beef <- as.numeric(Beef_data$Global_price_of_beef)

Beef_data$DATE <- as.Date(Beef_data$DATE, format = "%Y-%m-%d")



Beef_data.tsibble <- Beef_data %>%
  mutate(DATE = yearmonth(DATE)) %>%
  as_tsibble(index = DATE)

```

```{r}
names(Commodity_Price_index)[2] <- 'Price_index'

Commodity_Price_index$Price_index<- as.numeric(Commodity_Price_index$Price_index)

Commodity_Price_index$DATE<- as.Date(Commodity_Price_index$DATE, format = "%Y-%m-%d")



Commodity_Price.tsibble <- Commodity_Price_index %>%
  mutate(DATE = yearmonth(DATE)) %>%
  as_tsibble(index = DATE)

```


```{r}
names(Beef_US_price)[2] <- 'US_beef_price'

Beef_US_price$US_beef_price<- as.numeric(Beef_US_price$US_beef_price)

Beef_US_price$DATE<- as.Date(Beef_US_price$DATE, format = "%Y-%m-%d")



Beef_US_price.tsibble <- Beef_US_price %>%
  na.omit()%>%
  mutate(DATE = yearmonth(DATE)) %>%
  as_tsibble(index = DATE)

```



```{r}
Beef_US_production <- Beef_production_world %>%
  filter(Entity == 'United States')
Beef_US_production <- Beef_US_production[,-(1:2)]

names(Beef_US_production)[1] <- 'DATE'
names(Beef_US_production)[2] <- 'US_beef_production'

Beef_US_production$US_beef_production<- as.numeric(Beef_US_production$US_beef_production)
Beef_US_production$DATE<- as.numeric(Beef_US_production$DATE)

Beef_US_production$DATE <- as.Date(as.character(Beef_US_production$DATE), format = "%Y")


Beef_US_production.tsibble <- Beef_US_production %>%
  mutate(DATE = year(DATE)) %>%
  as_tsibble(index = DATE)
```

```{r}
names(Beef_price_annual)[2] <- 'Annual_beef_price'

Beef_price_annual$Annual_beef_price<- as.numeric(Beef_price_annual$Annual_beef_price)

Beef_price_annual$DATE<- as.Date(Beef_price_annual$DATE, format = "%Y")



Beef_price_annual.tsibble <- Beef_price_annual %>%
  mutate(DATE = year(DATE)) %>%
  as_tsibble(index = DATE)

```

```{r}
names(Corn_price_US)[2] <- 'US_corn_price'

Corn_price_US$US_corn_price<- as.numeric(Corn_price_US$US_corn_price)

Corn_price_US$DATE<- as.Date(Corn_price_US$DATE, format = "%Y-%m-%d")



Corn_price_US.tsibble <- Corn_price_US %>%
  mutate(DATE = yearmonth(DATE)) %>%
  as_tsibble(index = DATE)

```

```{r}
names(Corn_price)[2] <- 'corn_price'

Corn_price$corn_price<- as.numeric(Corn_price$corn_price)

Corn_price$date<- as.Date(Corn_price$date, format = "%Y-%m-%d")



Corn_price.tsibble <- Corn_price %>%
  as_tsibble(index = date)
```


-------------------------------------------------------------------




### Plotting the data
```{r}
Beef_data.tsibble %>%
ggplot(aes(x = DATE, y = Global_price_of_beef)) +
      geom_point(color = "darkorchid4") +
      labs(title = "Representation of global price of beef",
           subtitle = "Observations from 1990 to 2021",
           y = "Price",
           x = "Date") + theme_bw(base_size = 15)
```
```{r}
#YEAR <- as.numeric(format(Beef_data$DATE,'%Y'))
#Month <- as.numeric(format(Beef_data$DATE,'%m'))
```


```{r}
#Beef_data %>%
  #na.omit() %>%
#ggplot(aes(x = DATE, y = Global_price_of_beef)) +
      #geom_point(color = "darkorchid4") +
      #facet_wrap( ~ YEAR )+
      #labs(title = "Price of beef",
           #subtitle = "Use facets to plot by a variable - year in this case",
          # y = "Price",
          #x = "Date") + theme_bw(base_size = 15) +
     # adjust the x axis breaks
     #scale_x_date(date_breaks = "5 years", date_labels = "%m-%Y")
```


```{r}
#Beef_data.ts <- ts(Beef_data, start = 1990, frequency = 12)
```


### Plotting the data Global Price of beef in the world
```{r}
Beef_data.tsibble %>% autoplot(Global_price_of_beef)+geom_line()
```
# Plotting the data of the US beef price
```{r}
Beef_US_price.tsibble %>% autoplot(US_beef_price)+geom_line()
```
# Plotting the data US beef production
```{r}
Beef_US_production.tsibble %>% autoplot(US_beef_production)+geom_line()
```
# Plotting the data US beef production

```{r}
Commodity_Price.tsibble %>% autoplot(Price_index)+geom_line()
```
We have to be careful, because even if the plot looks similar to the beef price, in the commodity price index, the beef price is also included, so it impacts the price index. 


# Plotting the Global Corn price
```{r}
Corn_price.tsibble %>% autoplot(log(corn_price))+geom_line()
```

# Ploting US corn price
```{r}
Corn_price_US.tsibble %>% autoplot((US_corn_price))+geom_line()
```



